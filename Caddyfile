# Caddyfile for Budget App
# 
# Replace YOUR_DOMAIN with your actual domain (e.g., budget.example.com)
# Caddy automatically obtains and renews SSL certificates from Let's Encrypt

YOUR_DOMAIN {
    # API requests → Deno backend
    handle /api/* {
        reverse_proxy backend:8000
    }
    
    # Everything else → React frontend
    handle {
        reverse_proxy frontend:80
    }
    
    # Security headers
    header {
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
        # Remove server header
        -Server
    }
    
    # Enable compression
    encode gzip zstd
    
    # Logging
    log {
        output file /data/access.log {
            roll_size 10mb
            roll_keep 5
        }
    }
}

# Redirect www to non-www (optional, uncomment if needed)
# www.YOUR_DOMAIN {
#     redir https://YOUR_DOMAIN{uri} permanent
# }
